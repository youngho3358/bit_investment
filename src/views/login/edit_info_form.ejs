<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coin_investment</title>
    <script>
        function changePhone() {
            const changePhone = document.getElementById("phone_box").value;
            if (/^\d{11}$/.test(changePhone)) {
                let data = {changePhone}
                fetch("/login/change_phone",{
                            method : "post",
                            headers : {"Content-Type":"application/json"},
                            body : JSON.stringify(data)
                        })
                        .then(res => res.json())
                        .then(checkResult => {
                            if(checkResult == 1){
                                alert("전화번호가 변경되었습니다.");
                                location.href = "http://localhost:3000/login/edit_info_form";
                                return;
                            }else{
                                alert("전화번호 변경에 실패하였습니다.");
                                return;
                            }
                        })
                return;
            }else{
                alert("'-'을 제외한 11자리 숫자만 입력해주세요.");
                document.getElementById("phone_box").focus();
                return;
            }
        };
        function changeEmail() {
            const changeEmail = document.getElementById("email_box").value;
            const memberType = document.getElementById("member_type_result").value;

            // 이메일 주소 유효성 검사를 위한 정규 표현식
            var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if(memberType == "사이트 회원"){
                if (!emailPattern.test(changeEmail)) {
                    alert("이메일 형식을 올바르게 입력하세요.");
                    return;
                }

                let data = {changeEmail}
                fetch("/login/change_email",{
                            method : "post",
                            headers : {"Content-Type":"application/json"},
                            body : JSON.stringify(data)
                        })
                        .then(res => res.json())
                        .then(checkResult => {
                            if(checkResult == 1){
                                alert("이메일이 변경되었습니다.");
                                location.href = "http://localhost:3000/login/edit_info_form";
                                return;
                            }else{
                                alert("이메일 변경에 실패하였습니다.");
                                return;
                            }
                        })
                return;
            }else{
                alert("SNS 로그인 회원은 이메일 변경이 불가합니다.")
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        div{
            display: block;
        }
        a {
            text-decoration: none;
        }
        .wrap {
            min-width: 1340px;
            min-height: 1100px;
            background: #f1f1f3;
            padding-bottom: 20px;
        }
        .header {
            width: 1280px;
            height: 100px;
            margin: 0px auto 0px;
        }
        .container_1 {
            position: relative;
            height: 800px;
            width: 800px;
            margin: 10px auto 0px;
            border: 1px solid black;
            background: rgb(255, 255, 255);
            text-align: center;
        }
        .top_login_register_box {
            display: inline-block;
            height: 20px;
            margin-top: 40px;
            margin-left: 910px;
            font-size: 17px;
            font-weight: bolder;
            text-align: right;
        }
        .top_login_button {
            font-size: 20px;
            margin-right: 40px;
            color: white;
        }
        .top_register_button {
            font-size: 20px;
            margin-right: 40px;
            color: white;
        }
        .top_logo {
            position: absolute;
            width: 150px;
            height: 70px;
            margin-left: 30px;
            margin-top: 15px;
            border: none;
            text-align: center;
        }
        .top_menu{
            position: absolute;
            width: 700px;
            height: 70px;
            margin-left: 210px;
            margin-top: 15px;
        }
        .top_menu_link{
            display: inline-block;
            height: 26px;
            margin-top: 22px;
            font-size: 26px;
            font-weight: bold;
            color: white;
        }
        .myPage_box{
            position: relative;
            width: 800px;
            margin: 60px auto 20px;
        }

        .info_text_1{
            margin-top: 60px;
            margin-left: -475px;
        }
        .info_text_2{
            margin-top: 30px;
            margin-left: -520px;
            font-size: 18px;
        }
        .info_text_3{
            margin-top: 30px;
            margin-left: -495px;
            font-size: 18px;
        }
        .info_text_4{
            margin-top: 30px;
            margin-left: -535px;
            font-size: 18px;
        }
        .info_text_5{
            display: inline-block;
            margin-top: 30px;
            margin-left: -500px;
            font-size: 18px;
        }
        .info_text_6{
            display: inline-block;
            margin-top: 25px;
            margin-left: -520px;
            font-size: 18px;
        }
        #phone_change_button{
            position: absolute;
            display: inline-block;
            margin-top: 32px;
            margin-left: 465px;
            color: blue;
            text-decoration: underline;
        }
        #email_change_button{
            position: absolute;
            display: inline-block;
            margin-top: 27px;
            margin-left: 485px;
            color: blue;
            text-decoration: underline;
        }
        #phone_change_button:hover{
            cursor: pointer;
        }
        #email_change_button:hover{
            cursor: pointer;
        }
        .input_box{
            margin-top: 5px;
            width: 550px;
            height: 50px;
            padding-left: 20px;
            font-size: 18px;
            font-weight: 5px;
            border-radius: 4px;
            background: #f1f1f3;
        }
        #phone_box{
            margin-top: 5px;
            width: 550px;
            height: 50px;
            padding-left: 20px;
            font-size: 18px;
            font-weight: 5px;
            border-radius: 4px;
            background: #f1f1f3;
        }
        #live_phone_check{
            position: absolute;
            margin-left: -282px;
        }
        #email_box{
            margin-top: 5px;
            width: 550px;
            height: 50px;
            padding-left: 20px;
            font-size: 18px;
            font-weight: 5px;
            border-radius: 4px;
            background: #f1f1f3;
        }
        .back_button_box{
            position: relative;
            margin: 40px auto;
            height: 30px;
            width: 80px;
            text-align: center;
        }
        .back_button{
            background: #14776a;
            color: white;
            font-size: 15px;
            font-weight: bold;
            padding: 7px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div style="background-color: #14776a;">
            <div class="header">
                <div class="top_logo">
                    <a href="/">
                        <img src="<%=whitelogo%>" 
                            alt="logo"
                            height="70px"
                            >
                    </a>
                </div>
                <div class="top_menu">
                    <a href="" class="top_menu_link" style="margin-left: 20px;">거래소</a>
                    <a href="" class="top_menu_link" style="margin-left: 30px;">게시판</a>
                    <a href="" class="top_menu_link" style="margin-left: 30px;">내 코인</a>
                    <a href="" class="top_menu_link" style="margin-left: 30px;">거래내역</a>
                </div>
                <div class="top_login_register_box">
                    <% if(member) { %>
                        <a href="/login/userInfo" class="top_login_button">MY</a>
                        <a href="/login/logout" class="top_register_button">로그아웃</a>
                    <%} else{ %>
                        <a href="/login" class="top_login_button">로그인</a>
                        <a href="/register" class="top_register_button">회원가입</a>
                    <%}%>
                </div>
            </div>
        </div>
        <div class="myPage_box">
            <h1>회원정보 수정</h1>
        </div>
        <div class="container_1">
            <h2 class="info_text_1">회원 정보</h2>
            <p class="info_text_2">아이디</p>
            <input class="input_box" type="text" readonly value="<%=member.id%>">
            <br>
            <p id="member_type" class="info_text_3">회원 타입</p>
            <input id="member_type_result" class="input_box" type="text" readonly value="<%if( member.login_type  == 0){%>사이트 회원<%}else if( member.login_type  == 1){%>카카오톡 로그인 회원<%}else{%>네이버 로그인 회원<%}%>">
            <br>
            <p class="info_text_4">이름</p>
            <input class="input_box" type="text" readonly value="<%=member.name%>">
            <br>
            <p class="info_text_5">전화번호</p>
            <p id="phone_change_button" onclick="changePhone()">변경</p>
            <br>
            <input id="phone_box" type="text" maxlength="11" value="<%=member.phone%>">
            <br>
            <label id="live_phone_check">01012345678 과 같이 "-" 을 제외하고 입력해주세요.</label>
            <br>
            <p class="info_text_6">이메일</p>
            <p id="email_change_button" onclick="changeEmail()">변경</p>
            <br>
            <input id="email_box" type="text" value="<%=member.email%>">
            <br>
            <label id="live_phone_check">test@coin_investment.com 과 같은 형식으로 작성해주세요.</label>
            <br>
            <label id="live_phone_check">(비밀번호 찾기 시 사용되는 정보입니다.)</label>
            <br>
            <div class="back_button_box">
                <a href="/login/userInfo" class="back_button">돌아가기</a>
            </div>
        </div>
    </div>
</body>
</html>